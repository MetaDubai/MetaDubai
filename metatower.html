<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
	<title>MetaDubai</title>
	<link rel="shortcut icon" type="image/x-icon" href="img/favicon.png" />
	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/font-awesome.min.css" />
	<link rel="stylesheet" href="css/flaticon.css" />
	<link rel="stylesheet" href="css/owl.carousel.min.css" />
	<link rel="stylesheet" href="css/owl.theme.css" />
	<link rel="stylesheet" href="css/lightgallery.css" />
	<link rel="stylesheet" href="css/woocommerce.css" />
	<link rel="stylesheet" href="css/style.css?v=202207291911" />
	<link rel="stylesheet" href="css/home.css?v=202207291911" />
	<link rel="stylesheet" href="css/royal-preload.css" />
	<style type="text/css">
		.recruit br,
		.pre-sale br {
			display: none;
		}

		#signin {
			width: 1020px;
			height: 573.75px;
			position: relative;
		}

		#signin .background {
			border-radius: 32px;
			top: 0;
			left: 0;
			z-index: 1;
			position: absolute;
			width: 100%;
			height: 100%;
			background-image: linear-gradient( rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5) ), url('img/preview.jpg');
			background-position: center;
			background-repeat: no-repeat;
			background-size: cover;
		}

		#signin #form {
			z-index: 2;
			position: absolute;
			left:0;
			right:0;
			top: 0;
			bottom: 0;
			margin: auto;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		#signin #form > * {
			padding-left: 12px;
		}

		#signin #form:first-child  {
			padding-left: 0px;
		}
	</style>
</head>

<body class="royal_preloader">
	<div id="page" class="site">
		<header id="site-header" class="site-header header-static">
			<div class="header-desktop">
				<div class="octf-main-header is-fixed">
					<div class="container-fluid">
						<div class="row">
							<div class="col-logo align-self-center">
								<div id="site-logo" class="site-logo">
									<a href="index.html">
										<img src="img/logo.png" alt="Metahub" class="">
									</a>
								</div>
							</div>
							<!-- <div class="col-cta align-self-center">
								<div class="octf-btn-cta justify-content-end">
									<div class="octf-header-btn octf-cta-header">
										<nav id="site-navigation" class="main-navigation">
											<ul class="menu">
												<li><a href="index.html#MetaTower">MetaTower </a></li>
												<li><a href="index.html">Strategic Partners</a></li>
												<li><a href="index.html">Contact us</a></li>
											</ul>
										</nav>
									</div>
								</div>
							</div> -->
						</div>
					</div>
				</div>
			</div>

			<div class="header_mobile">
				<div class="container-fluid">
					<div class="octf-mainbar-row octf-row">
						<div class="octf-col">
							<div class="mlogo_wrapper clearfix">
								<div class="mobile_logo">
									<a href="index.html">
										<img src="img/logo.png" alt="Metahub">
									</a>
								</div>
							</div>
						</div>
						<!-- <div class="octf-col justify-content-end">
							<div id="mmenu-toggle" class="mmenu-toggle align-self-center">
								<button><i class="ot-flaticon-menu-of-three-lines"></i></button>
							</div>
							<div class="site-overlay mmenu-overlay"></div>
						</div>
						<div id="mmenu-wrapper" class="mmenu-wrapper on-right">
							<div class="mmenu-inner">
								<div class="mobile-nav">
									<ul id="menu-main-menu" class="mobile_mainmenu none-style">
										<li>
											<img src="./img/menu1.png" alt="">
											<a href="index.html#MetaTower">MetaTower</a>
										</li>
										<li><img src="./img/menu2.png" alt=""><a href="index.html#Strategic">Strategic Partners</a></li>
										<li><img src="./img/menu3.png" alt=""><a href="index.html#site-footer">Contact us</a></li>
									</ul>
								</div>

							</div>
						</div> -->
					</div>
				</div>
			</div>
		</header>

		<section class="metatower">
			<div class="con-box container">
				<div class="space-40 d-none d-lg-block "></div>

				<div id="signin">
					<div class="background"></div>
					<div id="form">
						<div><input type="text" id="displayName" name="displayName" placeholder="Display name"></div>
						<div><button value="Join" onclick="Join()">Join</button></div>
					</div>
				</div>

				<iframe
					frameBorder="0"
					src=""
					title="MetaDubai"
					allow="camera *;microphone *"
					width="1020"
					height="573.75"
					allowfullscreen="true"
					style="display: none"
					id="metaDubaiIframe">
				</iframe>


				<div class="space-30 d-none d-lg-block  d-md-block"></div>
				<p class="text-white  text-left  text-sm-center">
					Smartphone users can visit MetaTower through the app here
				</p>
				<div class="row px-20" style="display: flex;justify-content: center; align-items: center;">
					<div class="ios col-lg-6 col-md-6  col-sm-12  text-center mb-2">
						<a href="https://holofair.app.link/meta-dubai-guest" target="_blank">
							<img src="img/ios-google.png" alt="ios" style="margin-top: 0;">
							<img src="img/ios-google-qr.png" alt="" class="qrS">
						</a>
					</div>
					<div class="ios col-lg-6 col-md-6  col-sm-12   mb-2" >
						<div class="text-sm-center ahref" style="box-sizing: border-box;
						font-size: 14px;">
							<a href="https://www.metadubai.io/HoloFair_ Visit, Meet, Hangout_5.0.11.apk">
								<img src="img/apk.png" alt="" class="apk">
							</a>
							<div>
								Click the link after installing the app to visit MetaTower: <a href="https://holofair.app.link/meta-dubai-guest"
								target="_blank" class="link" style="font-size: 18px;">https://holofair.app.link/meta-dubai-guest</a>
							</div>
						</div>
					</div>


				</div>
				<div class="space-30"></div>

				<div class="space-80 d-none d-lg-block"></div>
				<!-- <div class="bottom text-left">
					<h2 class="mb-0">Stake 1 billion MDB to get ownership of a layer of MetaTower for free!</h2>
					<div class="space-20 d-none d-lg-block"></div>
					<div class="space-15 d-block d-sm-block d-md-none d-lg-none"></div>
					<div class="ownership">
						<p class="con-te">
							<span>MDB contract address(BSC): </span> <i>0x033Fc4eC65a22D29A87631e5feD9616A0d343f42 </i>
						</p>
						<p class="con-te">
							<span>The portal to trade MDB: </span>
							<a href="https://pancakeswap.finance/swap" target="_blank">
								<i>
									https://pancakeswap.finance/swap
								</i>
							</a>
						</p>
						<p class="con-te">
							<span>Don't hesitate to email us at </span> <i> official@metadubai.io</i> <span> if you want to know more!</span>
						</p>
					</div>
					<div class="space-30  d-lg-block"></div>
				</div> -->
			</div>
		</section>

	</div>
	<a id="back-to-top" href="#" class="show"><i class="ot-flaticon-up-arrow"></i></a>
	<script src="js/jquery.min.js"></script>
	<script src="js/lightgallery-all.min.js"></script>
	<script src="js/jquery.isotope.min.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/easypiechart.min.js"></script>
	<script src="js/jquery.countdown.min.js"></script>
	<script src="js/scripts.js"></script>
	<script src="js/contact.js"></script>
	<script src="js/royal_preloader.min.js"></script>
	<script>
		var signin = document.getElementById('signin');
		var displayNameInput = document.getElementById('displayName');
		var metaDubaiIframe = document.getElementById('metaDubaiIframe');
		var mobile_flag = false;
		var data = {};
		var uuid = "";

		function OnDisplayNameChange(val) {
			data = {
				"displayName": "" + val,
				"roleName": "Visitor",
				"roleColor": '#87de76'
			};
		}

		function Join() {
			OnDisplayNameChange(displayNameInput.value);
			let signUpRequest = new XMLHttpRequest();
			signUpRequest.open("POST", "https://metadubai.holofair.net/users/signup.php");

			signUpRequest.setRequestHeader("Accept", "application/json");
			signUpRequest.setRequestHeader("Content-Type", "application/json");

			signUpRequest.onload = () => {
				if(signUpRequest.status==500) {
					console.log("User already exists");
					SignIn();
				} else if(signUpRequest.status==400) {
					console.log("Data incomplete");
				} else if(signUpRequest.status==201){
					const response = JSON.parse(signUpRequest.responseText);
					if("success" in response && response.success) {
						SignIn();
					}
				} else {
					console.log("Uknown error. signUpRequest:", signUpRequest);
				}
			};

			signUpRequest.send(JSON.stringify(data));
		}

		function SignIn() {
			let signInRequest = new XMLHttpRequest();
			signInRequest.open("POST", "https://metadubai.holofair.net/users/signin.php");

			signInRequest.setRequestHeader("Accept", "application/json");
			signInRequest.setRequestHeader("Content-Type", "application/json");

			signInRequest.onload = () => {
				console.log("SignIn");
				if(signInRequest.status==200) {
					const response = JSON.parse(signInRequest.responseText);
					uuid = response.uuid;
					window.addEventListener("message", subscribe, false);
					signin.style.display = "none";
					metaDubaiIframe.style.display = "";
					metaDubaiIframe.src = "https://demo.readyplayer.me/avatar?frameApi";
				} else {
					console.log("Uknown error. signInRequest:", signInRequest);
				}
			}

			signInRequest.send(JSON.stringify(data));
		}

		function subscribe (event) {
			if(typeof(event.data) !== 'string') return;

			const json = JSON.parse(event.data);

			if (json?.source !== 'readyplayerme') return

			if (json.eventName === 'v1.frame.ready') {
				metaDubaiIframe.contentWindow.postMessage(
					JSON.stringify({
						target: 'readyplayerme',
						type: 'subscribe',
						eventName: 'v1.**'
					}),
					'*'
				)
			}

			if (json.eventName === 'v1.avatar.exported') {
				console.log(`uuid: ${uuid}`)
				let recordAvatar = new XMLHttpRequest();
				recordAvatar.open("POST", "https://api.holofair.net/users/avatars/create.php");

				recordAvatar.setRequestHeader("Accept", "application/json");
				recordAvatar.setRequestHeader("Content-Type", "application/json");

				let data = {
					"uuid": uuid,
					"avatar": json.data.url,
				};

				recordAvatar.onload = () => {
					if(recordAvatar.status==400) {
						console.log("[subscribe] avatar record", recordAvatar.responseText);
					} else {
						setTimeout(function(){
							window.removeEventListener("message", subscribe);
							if (mobile_flag) window.location.href = `https://holofair.net/event/join/?code=7053148&uuid=${uuid}`;
							else metaDubaiIframe.src = `https://d3nycf6vcruyvx.cloudfront.net/build/2021.3.1f1/stable/index.html?code=7053148&uuid=${uuid}`;
							console.log("[subscribe] welcome to holofair");
						}, 1000);
					}
				};

				recordAvatar.send(JSON.stringify(data));
			}

			// Get user id
			if (json.eventName === 'v1.user.set') {
				console.log(`User with id ${json.data.id} set: ${JSON.stringify(json)}`)
			}
		}

		window.jQuery = window.$ = jQuery;
		(function ($) {
			"use strict";
			Royal_Preloader.config({
				mode: 'logo',
				logo: 'img/logo.png',
				logo_size: [160, 75],
				showProgress: true,
				showPercentage: true,
				text_colour: '#fff',
				background: '#1F1F1F'
			});
			var userAgentInfo = navigator.userAgent;
			var mobile_Agents = ["Android", "iPhone", "Symbianos", "Windows Phone", "ipad", "ipod"];
			for (let index = 0; index < mobile_Agents.length; index++) {
				if (userAgentInfo.indexOf(mobile_Agents[index]) !== -1) {
					mobile_flag = true;
					$("iframe").attr("src", "javascript:false;");
					break;
				}
			}
		})(jQuery);
	</script>
</body>

</html>